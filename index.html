<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="styles.css">
  <title>ì»¤ë²„ ì´ë¯¸ì§€ ìƒì„±ê¸°</title>
</head>
<body>
  <header class="app-header">
    <div class="brand">ì»¤ë²„ ì´ë¯¸ì§€ ìƒì„±ê¸°</div>
    <!-- ì „ì²´ ì´ˆê¸°í™” -->
    <button id="reset-left-only" class="btn btn-ghost" aria-label="ì „ì²´ ì´ˆê¸°í™”" data-action="reset-all">
      ì´ˆê¸°í™”
    </button>
  </header>

  <main class="layout">
    <!-- ===== ì™¼ìª½ íŒ¨ë„ : êµ¬ë‹¨ ì„ íƒ ì˜ì—­ ===== -->
    <aside id="left-panel" class="panel-left" aria-label="êµ¬ë‹¨ ì„ íƒ">
      <!-- ê²€ìƒ‰ -->
      <div class="search-box">
        <label for="team-search" class="visually-hidden">êµ¬ë‹¨ ê²€ìƒ‰í•˜ê¸°</label>
        <img src="icons/search.svg" alt="ê²€ìƒ‰" class="icon-search">
        <input id="team-search" type="search" placeholder="êµ¬ë‹¨ ê²€ìƒ‰í•˜ê¸°" data-role="team-search" />
      </div>

      <!-- íƒ­: êµ­ë‚´ / í•´ì™¸ -->
      <div class="tabs" role="tablist" aria-label="ë¦¬ê·¸ êµ¬ë¶„">
        <button role="tab" aria-selected="true" id="tab-domestic" data-tab="domestic">êµ­ë‚´</button>
        <button role="tab" aria-selected="false" id="tab-overseas" data-tab="overseas">í•´ì™¸</button>
      </div>

      <!-- ì¢…ëª© ì•„ì½”ë””ì–¸ -->
      <nav class="sports-groups" aria-label="ì¢…ëª© ëª©ë¡">
        <!-- ì•¼êµ¬ -->
        <section class="sport-group" data-sport="baseball">
          <button class="sport-toggle" aria-expanded="true">
            <span class="icon" aria-hidden="true">
              <img src="icons/baseball.png" alt="ì•¼êµ¬" class="icon-img">
            </span>
            <span class="label">ì•¼êµ¬ êµ¬ë‹¨</span>
            <span class="count" data-count>10</span>
          </button>
          <ul class="team-list" role="list">
            <!-- ìƒ˜í”Œ íŒ€ -->
            <li class="team-item" data-team-id="doosan-bears">
              <button class="team-select" data-role="select-team" data-team="doosan-bears">
                <span class="team-logo" data-role="team-logo"></span>
                <span class="team-name">ë‘ì‚° ë² ì–´ìŠ¤</span>
              </button>
              <div class="team-actions">
                <button class="btn-mini" data-role="set-home" data-team="doosan-bears">ìš°ë¦¬ íŒ€</button>
                <button class="btn-mini" data-role="set-away" data-team="doosan-bears">ìƒëŒ€ íŒ€</button>
              </div>
            </li>
          </ul>
        </section>

        <!-- ì¶•êµ¬ -->
        <section class="sport-group" data-sport="football">
          <button class="sport-toggle" aria-expanded="false">
            <span class="icon" aria-hidden="true">
              <img src="icons/soccer.png" alt="ì¶•êµ¬" class="icon-img">
            </span>
            <span class="label">ì¶•êµ¬ êµ¬ë‹¨</span>
            <span class="count" data-count>15</span>
          </button>
          <ul class="team-list" hidden role="list"></ul>
        </section>

        <!-- ë†êµ¬ -->
        <section class="sport-group" data-sport="basketball">
          <button class="sport-toggle" aria-expanded="false">
            <span class="icon" aria-hidden="true">
              <img src="icons/basketball.png" alt="ë†êµ¬" class="icon-img">
            </span>
            <span class="label">ë†êµ¬ êµ¬ë‹¨</span>
            <span class="count" data-count>15</span>
          </button>
          <ul class="team-list" hidden role="list"></ul>
        </section>

        <!-- ë°°êµ¬ -->
        <section class="sport-group" data-sport="volleyball">
          <button class="sport-toggle" aria-expanded="false">
            <span class="icon" aria-hidden="true">
              <img src="icons/volleyball.png" alt="ë°°êµ¬" class="icon-img">
            </span>
            <span class="label">ë°°êµ¬ êµ¬ë‹¨</span>
            <span class="count" data-count>15</span>
          </button>
          <ul class="team-list" hidden role="list"></ul>
        </section>

        <!-- ë¡¤ -->
        <section class="sport-group" data-sport="lol">
          <button class="sport-toggle" aria-expanded="false">
            <span class="icon" aria-hidden="true">ğŸ®</span>
            <span class="label">ë¡¤ êµ¬ë‹¨</span>
            <span class="count" data-count>15</span>
          </button>
          <ul class="team-list" hidden role="list"></ul>
        </section>
      </nav>
    </aside>

    <!-- ===== ì˜¤ë¥¸ìª½ íŒ¨ë„ : ë¯¸ë¦¬ë³´ê¸° + ì„¤ì • ===== -->
    <section id="right-panel" class="panel-right">
      <div class="preview-card" aria-label="ì»¤ë²„ ë¯¸ë¦¬ë³´ê¸°">
        <div class="preview-toolbar">
          <button id="download-btn" class="btn" data-action="download">ë‹¤ìš´ë¡œë“œ</button>
        </div>

        <div class="preview-stage" role="img" aria-label="ìš°ë¦¬ íŒ€ê³¼ ìƒëŒ€ íŒ€ ë¹„êµ ì´ë¯¸ì§€" data-role="preview-stage">
          <div class="side home" data-side="home">
            <div class="logo-box" data-role="home-logo-box"></div>
            <div class="team-label" data-role="home-name">ìš°ë¦¬ íŒ€</div>
            <div class="score" data-role="home-score" aria-live="polite">0</div>
          </div>

          <div class="vs">vs</div>

          <div class="side away" data-side="away">
            <div class="logo-box" data-role="away-logo-box"></div>
            <div class="team-label" data-role="away-name">ìƒëŒ€ íŒ€</div>
            <div class="score" data-role="away-score" aria-live="polite">0</div>
          </div>
        </div>
      </div>

      <!-- ì„¤ì • í¼ -->
      <form class="controls" aria-label="ì»¤ë²„ ì„¤ì •" autocomplete="off">
        <div class="control-row">
          <label for="home-team" class="control-label">ìš°ë¦¬ íŒ€</label>
          <input id="home-team" type="text" readonly placeholder="ìš°ë¦¬ íŒ€ì„ ì„ íƒí•˜ì„¸ìš”" data-role="home-team-input" />
        </div>

        <div class="control-row">
          <label for="home-score" class="control-label">ìš°ë¦¬ íŒ€ ìŠ¤ì½”ì–´</label>
          <input id="home-score" type="number" min="0" step="1" value="0" data-role="home-score-input" />
        </div>

        <div class="control-row">
          <label for="away-team" class="control-label">ìƒëŒ€ íŒ€</label>
          <input id="away-team" type="text" readonly placeholder="ìƒëŒ€ íŒ€ì„ ì„ íƒí•˜ì„¸ìš”" data-role="away-team-input" />
        </div>

        <div class="control-row">
          <label for="away-score" class="control-label">ìƒëŒ€ íŒ€ ìŠ¤ì½”ì–´</label>
          <input id="away-score" type="number" min="0" step="1" value="0" data-role="away-score-input" />
        </div>

        <div class="control-row">
          <label class="control-label" for="text-color">ê¸€ì ìƒ‰</label>
          <div class="color-field">
            <input id="text-color" type="color" value="#000000" data-role="text-color" aria-label="ê¸€ì ìƒ‰ìƒ ì„ íƒ" />
            <input type="text" value="#000000" data-role="text-color-hex" aria-label="ê¸€ì ìƒ‰ìƒ HEX" />
          </div>
        </div>

        <div class="control-row">
          <label class="control-label" for="bg-color">ë°°ê²½ ìƒ‰</label>
          <div class="color-field">
            <input id="bg-color" type="color" value="#FFFFFF" data-role="bg-color" aria-label="ë°°ê²½ ìƒ‰ìƒ ì„ íƒ" />
            <input type="text" value="#FFFFFF" data-role="bg-color-hex" aria-label="ë°°ê²½ ìƒ‰ìƒ HEX" />
          </div>
        </div>
      </form>
    </section>
  </main>

  <!-- ì ‘ê·¼ì„± ë³´ì¡°ìš© í´ë˜ìŠ¤ -->
  <style>
    .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;}
    /* ë³´ì¡° ìŠ¤íƒ€ì¼: ë°˜ëŒ€ ì—­í• ì´ ì ê¸´ ë²„íŠ¼ í‘œì‹œ */
    .team-actions .btn-mini[disabled]{opacity:.45;cursor:not-allowed;}
  </style>

  <script>
/* =========================
   íŒ€ ë°ì´í„° (ìƒ˜í”Œ)
   ========================= */
const TEAM_DB = [
  {
    id: "doosan-bears",
    name: "ë‘ì‚° ë² ì–´ìŠ¤",
    league: "domestic",
    sport: "baseball",
    svg: `<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" aria-label="Doosan Bears">
      <circle cx="256" cy="256" r="240" fill="#0C1C2C"/>
      <circle cx="256" cy="256" r="200" fill="#fff"/>
      <circle cx="256" cy="256" r="170" fill="#E11D2E"/>
      <text x="50%" y="54%" text-anchor="middle" font-size="140" font-family="Arial Black, Arial" fill="#fff" dy=".35em">B</text>
    </svg>`
  },
  {
    id: "hanwha-eagles",
    name: "í•œí™” ì´ê¸€ìŠ¤",
    league: "domestic",
    sport: "baseball",
    svg: `<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" aria-label="Hanwha Eagles">
      <circle cx="256" cy="256" r="240" fill="#F97316"/>
      <text x="50%" y="54%" text-anchor="middle" font-size="120" font-family="Arial Black, Arial" fill="#111827" dy=".35em">E</text>
    </svg>`
  },
];

/* ===== ìƒíƒœ ===== */
const state = {
  tab: "domestic",
  search: "",
  homeTeamId: null,
  awayTeamId: null,
  homeScore: 0,
  awayScore: 0,
  textColor: "#000000",
  bgColor: "#FFFFFF",
  leftPanelSelected: { home: null, away: null }
};

/* ===== DOM ===== */
const $ = (sel, root = document) => root.querySelector(sel);
const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

const el = {
  resetLeft: $("#reset-left-only"),
  leftPanel: $("#left-panel"),
  teamSearch: $("#team-search"),
  tabDomestic: $("#tab-domestic"),
  tabOverseas: $("#tab-overseas"),
  sportsGroups: $(".sports-groups"),

  stage: $('[data-role="preview-stage"]'),
  homeLogoBox: $('[data-role="home-logo-box"]'),
  awayLogoBox: $('[data-role="away-logo-box"]'),
  homeName: $('[data-role="home-name"]'),
  awayName: $('[data-role="away-name"]'),
  homeScore: $('[data-role="home-score"]'),
  awayScore: $('[data-role="away-score"]'),

  homeTeamInput: $('[data-role="home-team-input"]'),
  awayTeamInput: $('[data-role="away-team-input"]'),
  homeScoreInput: $('[data-role="home-score-input"]'),
  awayScoreInput: $('[data-role="away-score-input"]'),
  textColor: $('[data-role="text-color"]'),
  textColorHex: $('[data-role="text-color-hex"]'),
  bgColor: $('[data-role="bg-color"]'),
  bgColorHex: $('[data-role="bg-color-hex"]'),
  downloadBtn: $("#download-btn"),
};

/* ===== ì´ˆê¸°í™” ===== */
-init();
+document.addEventListener('DOMContentLoaded', init);

function init(){
  buildLeftLists();
  bindEvents();
  renderRightPanel();
}


/* =========================
   ì™¼ìª½ íŒ¨ë„ êµ¬ì¶•
   ========================= */
function buildLeftLists() {
  const sections = $$(".sport-group", el.sportsGroups);
  sections.forEach(section => {
    const sport = section.getAttribute("data-sport");
    const ul = $(".team-list", section);
    const teams = TEAM_DB.filter(t =>
      t.sport === sport && t.league === state.tab && matchSearch(t)
    );

    const countSpan = $("[data-count]", section);
    if (countSpan) countSpan.textContent = teams.length;

    ul.innerHTML = "";
    teams.forEach(team => {
      const li = document.createElement("li");
      li.className = "team-item";
      li.dataset.teamId = team.id;

      const itemBtn = document.createElement("button");
      itemBtn.className = "team-select";
      itemBtn.dataset.role = "select-team";
      itemBtn.dataset.team = team.id;

      const logoSpan = document.createElement("span");
      logoSpan.className = "team-logo";
      logoSpan.innerHTML = team.svg;

      const nameSpan = document.createElement("span");
      nameSpan.className = "team-name";
      nameSpan.textContent = team.name;

      itemBtn.appendChild(logoSpan);
      itemBtn.appendChild(nameSpan);

      const actions = document.createElement("div");
      actions.className = "team-actions";

      const btnHome = document.createElement("button");
      btnHome.className = "btn-mini";
      btnHome.dataset.role = "set-home";
      btnHome.dataset.team = team.id;
      btnHome.textContent = "ìš°ë¦¬ íŒ€";

      const btnAway = document.createElement("button");
      btnAway.className = "btn-mini";
      btnAway.dataset.role = "set-away";
      btnAway.dataset.team = team.id;
      btnAway.textContent = "ìƒëŒ€ íŒ€";

      // ì„ íƒ í‘œì‹œ
      if (state.leftPanelSelected.home === team.id) btnHome.classList.add("is-selected");
      if (state.leftPanelSelected.away === team.id) btnAway.classList.add("is-selected");

      // ì„œë¡œ ì ê¸ˆ(ê°™ì€ íŒ€ì´ ë°˜ëŒ€ ì—­í• ë¡œ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ disable)
      btnHome.disabled = (state.leftPanelSelected.away === team.id);
      btnAway.disabled = (state.leftPanelSelected.home === team.id);
      btnHome.toggleAttribute("aria-disabled", btnHome.disabled);
      btnAway.toggleAttribute("aria-disabled", btnAway.disabled);

      actions.appendChild(btnHome);
      actions.appendChild(btnAway);

      li.appendChild(itemBtn);
      li.appendChild(actions);
      ul.appendChild(li);
    });

    const expanded = $(".sport-toggle", section)?.getAttribute("aria-expanded") === "true";
    ul.hidden = !expanded;
  });
}

function matchSearch(team) {
  if (!state.search) return true;
  const q = state.search.trim().toLowerCase();
  return team.name.toLowerCase().includes(q) || team.id.includes(q);
}

/* =========================
   ì˜¤ë¥¸ìª½ íŒ¨ë„ ë Œë”
   ========================= */
function renderRightPanel() {
  el.stage.style.backgroundColor = state.bgColor;
  $$(".team-label, .score, .vs", el.stage).forEach(n => n.style.color = state.textColor);

  el.homeName.textContent = state.homeTeamId ? getTeam(state.homeTeamId).name : "ìš°ë¦¬ íŒ€";
  el.awayName.textContent = state.awayTeamId ? getTeam(state.awayTeamId).name : "ìƒëŒ€ íŒ€";

  el.homeScore.textContent = state.homeScore;
  el.awayScore.textContent = state.awayScore;

  el.homeLogoBox.innerHTML = state.homeTeamId ? getTeam(state.homeTeamId).svg : placeholderBox();
  el.awayLogoBox.innerHTML = state.awayTeamId ? getTeam(state.awayTeamId).svg : placeholderBox();

  el.homeTeamInput.value = state.homeTeamId ? getTeam(state.homeTeamId).name : "";
  el.awayTeamInput.value = state.awayTeamId ? getTeam(state.awayTeamId).name : "";

  el.textColor.value = state.textColor;
  el.textColorHex.value = state.textColor.toUpperCase();
  el.bgColor.value = state.bgColor;
  el.bgColorHex.value = state.bgColor.toUpperCase();
}

function placeholderBox(){
  return `<div style="width:140px;height:140px;border:2px dashed #ddd;border-radius:16px"></div>`;
}
function getTeam(id){ return TEAM_DB.find(t => t.id === id) || null; }

/* =========================
   ì´ë²¤íŠ¸ ë°”ì¸ë”©
   ========================= */
function bindEvents() {
  // íƒ­ ì „í™˜
  el.tabDomestic.addEventListener("click", () => setTab("domestic"));
  el.tabOverseas.addEventListener("click", () => setTab("overseas"));

  // ê²€ìƒ‰
  el.teamSearch.addEventListener("input", e => {
    state.search = e.target.value;
    buildLeftLists();
  });

  // ì•„ì½”ë””ì–¸
  el.sportsGroups.addEventListener("click", e => {
    const toggle = e.target.closest(".sport-toggle");
    if (toggle) {
      const section = toggle.closest(".sport-group");
      const ul = $(".team-list", section);
      const expanded = toggle.getAttribute("aria-expanded") === "true";
      toggle.setAttribute("aria-expanded", String(!expanded));
      ul.hidden = expanded;
      return;
    }
  });

  // ì¢Œì¸¡ íŒ¨ë„ ë²„íŠ¼(ìš°ë¦¬/ìƒëŒ€) í´ë¦­ ìœ„ì„: ìƒí˜¸ë°°íƒ€ + í† ê¸€
  el.leftPanel.addEventListener("click", e => {
    const homeBtn = e.target.closest('[data-role="set-home"]');
    const awayBtn = e.target.closest('[data-role="set-away"]');
    if (homeBtn) {
      e.preventDefault();
      selectTeam("home", homeBtn.dataset.team);
    }
    if (awayBtn) {
      e.preventDefault();
      selectTeam("away", awayBtn.dataset.team);
    }
  });

  // ì ìˆ˜
  el.homeScoreInput.addEventListener("input", e => {
    state.homeScore = clampNonNegativeInt(e.target.value);
    e.target.value = state.homeScore;
    renderRightPanel();
  });
  el.awayScoreInput.addEventListener("input", e => {
    state.awayScore = clampNonNegativeInt(e.target.value);
    e.target.value = state.awayScore;
    renderRightPanel();
  });

  // ìƒ‰ìƒ
  el.textColor.addEventListener("input", e => { state.textColor = normalizeHex(e.target.value); renderRightPanel(); });
  el.textColorHex.addEventListener("input", e => { const hex = normalizeHex(e.target.value); if (hex) state.textColor = hex; renderRightPanel(); });
  el.bgColor.addEventListener("input", e => { state.bgColor = normalizeHex(e.target.value); renderRightPanel(); });
  el.bgColorHex.addEventListener("input", e => { const hex = normalizeHex(e.target.value); if (hex) state.bgColor = hex; renderRightPanel(); });

  // â˜… ì „ì²´ ì´ˆê¸°í™”
  el.resetLeft.addEventListener("click", resetAll);

  // ë‹¤ìš´ë¡œë“œ
  el.downloadBtn.addEventListener("click", downloadComposite);
}

// ì—­í•  ì„ íƒ: ìƒí˜¸ë°°íƒ€ + í† ê¸€
function selectTeam(role, teamId) {
  const other = (role === "home") ? "away" : "home";

  // ê°™ì€ íŒ€ì´ ë°˜ëŒ€ ì—­í• ë¡œ ì´ë¯¸ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ í—ˆìš© ë¶ˆê°€(ë¨¼ì € í•´ì œ í•„ìš”)
  if (state.leftPanelSelected[other] === teamId) return;

  // ê°™ì€ ì—­í• ì— ê°™ì€ íŒ€ì´ ì´ë¯¸ ìˆìœ¼ë©´ â†’ í•´ì œ(í† ê¸€)
  if (state.leftPanelSelected[role] === teamId) {
    state.leftPanelSelected[role] = null;
    state[role + "TeamId"] = null;
  } else {
    // ë‹¤ë¥¸ íŒ€ìœ¼ë¡œ êµì²´
    state.leftPanelSelected[role] = teamId;
    state[role + "TeamId"] = teamId;
  }
  renderRightPanel();
  buildLeftLists();
}

function setTab(tab){
  state.tab = tab;
  el.tabDomestic.setAttribute("aria-selected", String(tab === "domestic"));
  el.tabOverseas.setAttribute("aria-selected", String(tab === "overseas"));
  buildLeftLists();
}

/* =========================
   ìœ í‹¸
   ========================= */
function clampNonNegativeInt(v){ const n = parseInt(v,10); return (Number.isNaN(n)||n<0)?0:n; }
function normalizeHex(v){
  if(!v) return "#000000";
  let x=v.trim().toUpperCase(); if(!x.startsWith("#")) x="#"+x;
  if(/^#([0-9A-F]{3})$/.test(x)){ const r=x[1],g=x[2],b=x[3]; x=`#${r}${r}${g}${g}${b}${b}`; }
  if(/^#([0-9A-F]{6})$/.test(x)) return x;
  return "#000000";
}

/* =========================
   ì „ì²´ ì´ˆê¸°í™”
   ========================= */
function resetAll(){
  // ê²€ìƒ‰/íƒ­
  state.search = ""; if (el.teamSearch) el.teamSearch.value = "";
  setTab("domestic");

  // ì„ íƒ/ì ìˆ˜/ìƒ‰ìƒ
  state.homeTeamId = null;
  state.awayTeamId = null;
  state.leftPanelSelected.home = null;
  state.leftPanelSelected.away = null;
  state.homeScore = 0; state.awayScore = 0;
  state.textColor = "#000000"; state.bgColor = "#FFFFFF";

  // ì…ë ¥ê°’ ë™ê¸°í™”
  el.homeScoreInput.value = "0";
  el.awayScoreInput.value = "0";
  el.textColor.value = state.textColor; el.textColorHex.value = state.textColor;
  el.bgColor.value = state.bgColor;     el.bgColorHex.value = state.bgColor;

  renderRightPanel();
  buildLeftLists();
}

/* =========================
   ë‹¤ìš´ë¡œë“œ (SVG í•©ì„± â†’ PNG)
   ========================= */
function downloadComposite() {
  const W=1600,H=640,logoBox=280;
  const tColor=state.te
