<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="styles.css">
  <title>ì»¤ë²„ ì´ë¯¸ì§€ ìƒì„±ê¸°</title>
  <!-- í•„ìš” ì‹œ CSS/JS ì¶”ê°€ -->
</head>
<body>
  <header class="app-header">
    <div class="brand">ì»¤ë²„ ì´ë¯¸ì§€ ìƒì„±ê¸°</div>
    <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„(ë¯¸ë¦¬ë³´ê¸°/ì„¤ì •)ì€ ìœ ì§€, ì™¼ìª½ íŒ¨ë„ë§Œ ì´ˆê¸°í™” -->
    <button id="reset-left-only" class="btn btn-ghost" aria-label="ì™¼ìª½ íŒ¨ë„ ì´ˆê¸°í™”" data-action="reset-left">
      ì´ˆê¸°í™”
    </button>
  </header>

  <main class="layout">
    <!-- ===== ì™¼ìª½ íŒ¨ë„ : êµ¬ë‹¨ ì„ íƒ ì˜ì—­ ===== -->
    <aside id="left-panel" class="panel-left" aria-label="êµ¬ë‹¨ ì„ íƒ">
      <!-- ê²€ìƒ‰ -->
      <div class="search-box">
        <label for="team-search" class="visually-hidden">êµ¬ë‹¨ ê²€ìƒ‰í•˜ê¸°</label>
        <img src="icons/search.svg" alt="ê²€ìƒ‰" class="icon-search">
        <input id="team-search" type="search" placeholder="êµ¬ë‹¨ ê²€ìƒ‰í•˜ê¸°" data-role="team-search" />
      </div>

      <!-- íƒ­: êµ­ë‚´ / í•´ì™¸ -->
      <div class="tabs" role="tablist" aria-label="ë¦¬ê·¸ êµ¬ë¶„">
        <button role="tab" aria-selected="true" id="tab-domestic" data-tab="domestic">êµ­ë‚´</button>
        <button role="tab" aria-selected="false" id="tab-overseas" data-tab="overseas">í•´ì™¸</button>
      </div>

      <!-- ì¢…ëª© ì•„ì½”ë””ì–¸ -->
      <nav class="sports-groups" aria-label="ì¢…ëª© ëª©ë¡">
        <!-- ì•¼êµ¬ -->
        <section class="sport-group" data-sport="baseball">
          <button class="sport-toggle" aria-expanded="false">
            <span class="icon" aria-hidden="true">
              <img src="icons/baseball.png" alt="ì•¼êµ¬" class="icon-img">
            </span>
            <span class="label">ì•¼êµ¬ êµ¬ë‹¨</span>
            <span class="count" data-count>10</span>
          </button>
          <ul class="team-list" role="list">
            <!-- íŒ€ ì•„ì´í…œ í…œí”Œë¦¿ -->
            <!-- ê° íŒ€ì€ ë¡œê³ , íŒ€ëª…, ìš°ë¦¬íŒ€/ìƒëŒ€íŒ€ ì§€ì • ë²„íŠ¼ -->
            <li class="team-item" data-team-id="doosan-bears">
              <button class="team-select" data-role="select-team" data-team="doosan-bears">
                <img src="" alt="" class="team-logo" data-role="team-logo" />
                <span class="team-name">ë‘ì‚° ë² ì–´ìŠ¤</span>
              </button>
              <div class="team-actions">
                <button class="btn-mini" data-role="set-home" data-team="doosan-bears">ìš°ë¦¬ íŒ€</button>
                <button class="btn-mini" data-role="set-away" data-team="doosan-bears">ìƒëŒ€ íŒ€</button>
              </div>
            </li>

            <!-- ë‹¤ë¥¸ íŒ€ë“¤ë„ ë™ì¼ êµ¬ì¡°ë¡œ ë Œë”ë§ -->
          </ul>
        </section>

        <!-- ì¶•êµ¬ -->
        <section class="sport-group" data-sport="soccer">
          <button class="sport-toggle" aria-expanded="false">
            <span class="icon" aria-hidden="true">
              <img src="icons/soccer.png" alt="ì¶•êµ¬" class="icon-img">
            </span>
            <span class="label">ì¶•êµ¬ êµ¬ë‹¨</span>
            <span class="count" data-count>15</span>
          </button>
          <ul class="team-list" hidden role="list"></ul>
        </section>

        <!-- ë†êµ¬ -->
        <section class="sport-group" data-sport="basketball">
          <button class="sport-toggle" aria-expanded="false">
            <span class="icon" aria-hidden="true">
              <img src="icons/basketball.png" alt="ë†êµ¬" class="icon-img">
            </span>
            <span class="label">ë†êµ¬ êµ¬ë‹¨</span>
            <span class="count" data-count>15</span>
          </button>
          <ul class="team-list" hidden role="list"></ul>
        </section>

        <!-- ë°°êµ¬ -->
        <section class="sport-group" data-sport="volleyball">
          <button class="sport-toggle" aria-expanded="false">
            <span class="icon" aria-hidden="true">
              <img src="icons/volleyball.png" alt="ë°°êµ¬" class="icon-img">
            </span>
            <span class="label">ë°°êµ¬ êµ¬ë‹¨</span>
            <span class="count" data-count>15</span>
          </button>
          <ul class="team-list" hidden role="list"></ul>
        </section>

        <!-- ë¡¤ -->
        <section class="sport-group" data-sport="lol">
          <button class="sport-toggle" aria-expanded="false">
            <span class="icon" aria-hidden="true">ğŸ®</span>
            <span class="label">ë¡¤ êµ¬ë‹¨</span>
            <span class="count" data-count>15</span>
          </button>
          <ul class="team-list" hidden role="list"></ul>
        </section>
      </nav>
    </aside>

    <!-- ===== ì˜¤ë¥¸ìª½ íŒ¨ë„ : ë¯¸ë¦¬ë³´ê¸° + ì„¤ì • ===== -->
    <section id="right-panel" class="panel-right">
      <!-- ë¯¸ë¦¬ë³´ê¸° ìº”ë²„ìŠ¤ -->
      <div class="preview-card" aria-label="ì»¤ë²„ ë¯¸ë¦¬ë³´ê¸°">
        <div class="preview-toolbar">
          <button id="download-btn" class="btn" data-action="download">
          <span class="icon" aria-hidden="true"></span>
          <span class="label">ë‹¤ìš´ë¡œë“œ</span>
          </button>
        </div>

        <div class="preview-stage" role="img" aria-label="ìš°ë¦¬ íŒ€ê³¼ ìƒëŒ€ íŒ€ ë¹„êµ ì´ë¯¸ì§€" data-role="preview-stage">
          <!-- ë¡œê³  ì˜ì—­ -->
          <div class="side home" data-side="home">
            <div class="logo-box" data-role="home-logo-box" aria-label="ìš°ë¦¬ íŒ€ ë¡œê³ ">
              <!-- ë™ì  ë¡œê³  img ì‚½ì… -->
            </div>
            <div class="team-label" data-role="home-name">ìš°ë¦¬ íŒ€</div>
            <div class="score" data-role="home-score" aria-live="polite">0</div>
          </div>

          <div class="vs">vs</div>

          <div class="side away" data-side="away">
            <div class="logo-box" data-role="away-logo-box" aria-label="ìƒëŒ€ íŒ€ ë¡œê³ "></div>
            <div class="team-label" data-role="away-name">ìƒëŒ€ íŒ€</div>
            <div class="score" data-role="away-score" aria-live="polite">0</div>
          </div>
        </div>
      </div>

      <!-- ì„¤ì • í¼ -->
      <form class="controls" aria-label="ì»¤ë²„ ì„¤ì •" autocomplete="off">
        <!-- ìš°ë¦¬ íŒ€ -->
        <div class="control-row">
          <label for="home-team" class="control-label">ìš°ë¦¬ íŒ€</label>
          <input id="home-team" type="text" placeholder="ìš°ë¦¬ íŒ€ì„ ì„ íƒí•˜ì„¸ìš”" data-role="home-team-input" />
        </div>

        <div class="control-row">
          <label for="home-score" class="control-label">ìš°ë¦¬ íŒ€ ìŠ¤ì½”ì–´</label>
          <input id="home-score" type="number" min="0" step="1" value="0" data-role="home-score-input" />
        </div>

        <!-- ìƒëŒ€ íŒ€ -->
        <div class="control-row">
          <label for="away-team" class="control-label">ìƒëŒ€ íŒ€</label>
          <input id="away-team" type="text" placeholder="ìƒëŒ€ íŒ€ì„ ì„ íƒí•˜ì„¸ìš”" data-role="away-team-input" />
        </div>

        <div class="control-row">
          <label for="away-score" class="control-label">ìƒëŒ€ íŒ€ ìŠ¤ì½”ì–´</label>
          <input id="away-score" type="number" min="0" step="1" value="0" data-role="away-score-input" />
        </div>

        <!-- ì»¬ëŸ¬ ì„¤ì • -->
        <div class="control-row">
          <label class="control-label" for="text-color">ê¸€ì ìƒ‰</label>
          <div class="color-field">
            <input id="text-color" type="color" value="#000000" data-role="text-color" aria-label="ê¸€ì ìƒ‰ìƒ ì„ íƒ" />
            <input type="text" value="#000000" data-role="text-color-hex" aria-label="ê¸€ì ìƒ‰ìƒ HEX" />
          </div>
        </div>

        <div class="control-row">
          <label class="control-label" for="bg-color">ë°°ê²½ ìƒ‰</label>
          <div class="color-field">
            <input id="bg-color" type="color" value="#FFFFFF" data-role="bg-color" aria-label="ë°°ê²½ ìƒ‰ìƒ ì„ íƒ" />
            <input type="text" value="#FFFFFF" data-role="bg-color-hex" aria-label="ë°°ê²½ ìƒ‰ìƒ HEX" />
          </div>
        </div>
      </form>
    </section>
  </main>

  <!-- ì ‘ê·¼ì„± ë³´ì¡°ìš© í´ë˜ìŠ¤ -->
  <style>
    .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;}
  </style>
  <script>

// sport í´ë”ëª…ì´ í˜„ì¬ 'baseball', 'soccer' ë“±ì´ë¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
// ë§Œì•½ '1-baseball'ì²˜ëŸ¼ ë„˜ë²„ë§ì„ ìœ ì§€í•œë‹¤ë©´ ë§¤í•‘ì„ ì‚¬ìš©í•˜ì„¸ìš”.

    const LOGO_BASE = "icons";  // ë£¨íŠ¸
const LEAGUE_DIR = {
  domestic: "domestic-team",
  overseas: "overseas-team", // ì¶”í›„ í•´ì™¸ ì¶”ê°€ ëŒ€ë¹„
};
const SPORT_DIR = {
  baseball: "baseball",
  soccer: "soccer",
  basketball: "basketball",
  volleyball: "volleyball",
  lol: "lol",
};

async function ensureTeamSvg(team){
  if (!team) return null;
  if (team.svg) return team.svg;                 // ì´ë¯¸ ìˆìœ¼ë©´ ì¬í™œìš©
  const res = await fetch(logoPath(team), { cache: "no-store" });
  if (!res.ok) return null;
  team.svg = await res.text();
  return team.svg;
}
    
async function preloadTeamLogos() {
  await Promise.all(
    TEAM_DB.map(async (t) => {
      try {
        const res = await fetch(logoPath(t), { cache: "no-store" });
        if (res.ok) {
          const svgText = await res.text();
          t.svg = svgText; // ê¸°ì¡´ ë¡œì§ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        } else {
          console.warn("Logo not found:", logoPath(t));
        }
      } catch (e) {
        console.warn("Logo load error:", t.id, e);
      }
    })
  );
}

/* =========================
   íŒ€ ë°ì´í„° (ìƒ˜í”Œ)
   - id: ê³ ìœ ê°’ (ì˜ë¬¸/ìˆ«ì/í•˜ì´í”ˆ ê¶Œì¥)
   - name: í‘œì‹œ ì´ë¦„
   - league: domestic / overseas
   - sport: baseball | soccer | basketball | volleyball | lol
   - svg: ë¡œê³  SVG ë¬¸ìì—´ (viewBoxê°€ í¬í•¨ëœ ìˆœìˆ˜ <svg> ...)
   ========================= */
const TEAM_DB = [
   {
    id: "kia-tigers",
    name: "KIA íƒ€ì´ê±°ì¦ˆ",
    league: "domestic",
    sport: "baseball"
  },
  {
    id: "samsung-lions",
    name: "ì‚¼ì„± ë¼ì´ì˜¨ì¦ˆ",
    league: "domestic",
    sport: "baseball"
  },
  {
    id: "lg-twins",
    name: "LG íŠ¸ìœˆìŠ¤",
    league: "domestic",
    sport: "baseball"
  },
  {
    id: "doosan-bears",
    name: "ë‘ì‚° ë² ì–´ìŠ¤",
    league: "domestic",
    sport: "baseball"
  },
  {
    id: "kt-wiz",
    name: "kt wiz",
    league: "domestic",
    sport: "baseball"
  },
  {
    id: "ssg-landers",
    name: "SSG ëœë”ìŠ¤",
    league: "domestic",
    sport: "baseball"
  },
  {
    id: "lotte-giants",
    name: "ë¡¯ë° ìì´ì–¸ì¸ ",
    league: "domestic",
    sport: "baseball"
  },
  {
    id: "hanwha-eagles",
    name: "í•œí™” ì´ê¸€ìŠ¤",
    league: "domestic",
    sport: "baseball"
  },
  {
    id: "nc-dinos",
    name: "NC ë‹¤ì´ë…¸ìŠ¤",
    league: "domestic",
    sport: "baseball"
  },
  {
    id: "kiwoom-heroes",
    name: "í‚¤ì›€ íˆì–´ë¡œì¦ˆ",
    league: "domestic",
    sport: "baseball"
  },
  {
    id: "gangwon-fc",
    name: "ê°•ì› FC",
    league: "domestic",
    sport: "soccer"
  },
  {
    id: "gwangju-fc",
    name: "ê´‘ì£¼ FC",
    league: "domestic",
    sport: "soccer"
  },
  {
    id: "gimcheon-sangmu-fc",
    name: "ê¹€ì²œ ìƒë¬´ FC",
    league: "domestic",
    sport: "soccer"
  },
   {
    id: "daegu-fc",
    name: "ëŒ€êµ¬ FC",
    league: "domestic",
    sport: "soccer"
  },
  {
    id: "daejeon-hana-citizen",
    name: "ëŒ€ì „ í•˜ë‚˜ ì‹œí‹°ì¦Œ",
    league: "domestic",
    sport: "soccer"
  },
  {
    id: "seoul-fc",
    name: "FC ì„œìš¸",
    league: "domestic",
    sport: "soccer"
  },
  {
    id: "suwon-fc",
    name: "ìˆ˜ì› FC",
    league: "domestic",
    sport: "soccer"
  },
  {
    id: "anyang-fc",
    name: "FC ì•ˆì–‘",
    league: "domestic",
    sport: "soccer"
  },
    {
    id: "ulsan-hd-fc",
    name: "ìš¸ì‚° HD FC",
    league: "domestic",
    sport: "soccer"
  },
   {
    id: "jeonbuk-motors-fc",
    name: "ì „ë¶ í˜„ëŒ€ ëª¨í„°ìŠ¤",
    league: "domestic",
    sport: "soccer"
  },
   {
    id: "jeju-sk-fc",
    name: "ì œì£¼ SK FC",
    league: "domestic",
    sport: "soccer"
  },
  {
    id: "pohang-steelers-fc",
    name: "í¬í•­ ìŠ¤í‹¸ëŸ¬ìŠ¤",
    league: "domestic",
    sport: "soccer"
  },
  {
    id: "gyeongnam-fc",
    name: "ê²½ë‚¨ FC",
    league: "domestic",
    sport: "soccer"
  },
    {
    id: "gimpo-fc",
    name: "ê¹€í¬ FC",
    league: "domestic",
    sport: "soccer"
  },
   {
    id: "busan-ipark-fc",
    name: "ë¶€ì‚° ì•„ì´íŒŒí¬ FC",
    league: "domestic",
    sport: "soccer"
  },
    {
    id: "bucheon-fc-1995",
    name: "ë¶€ì²œ FC 1995",
    league: "domestic",
    sport: "soccer"
  },
   {
    id: "seoul-e-land-fc",
    name: "ì„œìš¸ ì´ëœë“œ FC",
    league: "domestic",
    sport: "soccer"
  },
  {
    id: "seongnam-fc",
    name: "ì„œìš¸ ì´ëœë“œ FC",
    league: "domestic",
    sport: "soccer"
  },
   {
    id: "suwon-samsung-bluewings",
    name: "ìˆ˜ì› ì‚¼ì„± ë¸”ë£¨ìœ™ì¦ˆ",
    league: "domestic",
    sport: "soccer"
  },
    {
    id: "ansan-greeners-fc",
    name: "ì•ˆì‚° ê·¸ë¦¬ë„ˆìŠ¤ FC",
    league: "domestic",
    sport: "soccer"
  },
   {
    id: "incheon-united-fc",
    name: "ì¸ì²œ ìœ ë‚˜ì´í‹°ë“œ FC",
    league: "domestic",
    sport: "soccer"
  },
   {
    id: "jeonnam-dragons",
    name: "ì „ë‚¨ ë“œë˜ê³¤ì¦ˆ",
    league: "domestic",
    sport: "soccer"
  },
   {
    id: "chungnam-asan-fc",
    name: "ì¶©ë‚¨ ì•„ì‚° FC",
    league: "domestic",
    sport: "soccer"
  },
   {
    id: "cheongju-fc",
    name: "ì¶©ë¶ ì²­ì£¼ FC",
    league: "domestic",
    sport: "soccer"
  },
   {
    id: "cheonan-city-fc",
    name: "ì²œì•ˆì‹œí‹° FC",
    league: "domestic",
    sport: "soccer"
  },
   {
    id: "hwaseong-fc",
    name: "í™”ì„± FC",
    league: "domestic",
    sport: "soccer"
  },
   {
    id: "goyang-sono-skygunners",
    name: "ê³ ì–‘ ì†Œë…¸ ìŠ¤ì¹´ì´ê±°ë„ˆìŠ¤",
    league: "domestic",
    sport: "basketball"
  },
    {
    id: "daegu-kogas-Pegasus",
    name: "ëŒ€êµ¬ í•œêµ­ê°€ìŠ¤ê³µì‚¬ í˜ê°€ìˆ˜ìŠ¤",
    league: "domestic",
    sport: "basketball"
  },
    {
    id: "busan-kcc-egis",
    name: "ë¶€ì‚° KCC ì´ì§€ìŠ¤",
    league: "domestic",
    sport: "basketball"
  },
    {
    id: "seoul-samsung-thunders",
    name: "ì„œìš¸ ì‚¼ì„± ì¬ë”ìŠ¤",
    league: "domestic",
    sport: "basketball"
  },
    {
    id: "seoul-sk-knights",
    name: "ì„œìš¸ SK ë‚˜ì´ì¸ ",
    league: "domestic",
    sport: "basketball"
  },
    {
    id: "suwon-kt-sonicboom",
    name: "ìˆ˜ì› kt ì†Œë‹‰ë¶",
    league: "domestic",
    sport: "basketball"
  },
   {
    id: "anyang-red-boosters",
    name: "ì•ˆì–‘ ì •ê´€ì¥ ë ˆë“œë¶€ìŠ¤í„°ìŠ¤",
    league: "domestic",
    sport: "basketball"
  },
    {
    id: "ulsan-hyundai-mobis-phoebus",
    name: "ìš¸ì‚° í˜„ëŒ€ëª¨ë¹„ìŠ¤ í”¼ë²„ìŠ¤",
    league: "domestic",
    sport: "basketball"
  },
    {
    id: "wonju-db-promy",
    name: "ì›ì£¼ DB í”„ë¡œë¯¸",
    league: "domestic",
    sport: "basketball"
  },
    {
    id: "changwon-lg-sakers",
    name: "ì°½ì› LG ì„¸ì´ì»¤ìŠ¤",
    league: "domestic",
    sport: "basketball"
  },
  {
    id: "cheonan-hyundai-capital-skywalkers",
    name: "ì²œì•ˆ í˜„ëŒ€ìºí”¼íƒˆ ìŠ¤ì¹´ì´ì›Œì»¤ìŠ¤",
    league: "domestic",
    sport: "volleyball"
  },
    {
    id: "incheon-korean-air-jumbos",
    name: "ì¸ì²œ ëŒ€í•œí•­ê³µ ì ë³´ìŠ¤",
    league: "domestic",
    sport: "volleyball"
  },
    {
    id: "uijeongbu-kB0Insurance-stars",
    name: "ì˜ì •ë¶€ KBì†í•´ë³´í—˜ ìŠ¤íƒ€ì¦ˆ",
    league: "domestic",
    sport: "volleyball"
  },
    {
    id: "suwon-kepco-vixtorm",
    name: "ìˆ˜ì› í•œêµ­ì „ë ¥ ë¹…ìŠ¤í†°",
    league: "domestic",
    sport: "volleyball"
  },
    {
    id: "seoul-woori-card-woori-won",
    name: "ì„œìš¸ ìš°ë¦¬ì¹´ë“œ ìš°ë¦¬WON",
    league: "domestic",
    sport: "volleyball"
  },
    {
    id: "daejeon-samsung-bluefangs",
    name: "ëŒ€ì „ ì‚¼ì„±í™”ì¬ ë¸”ë£¨íŒ¡ìŠ¤",
    league: "domestic",
    sport: "volleyball"
  },
    {
    id: "busan-ok-savings-bank-okman",
    name: "ë¶€ì‚° OKì €ì¶•ì€í–‰ ìë§¨",
    league: "domestic",
    sport: "volleyball"
  },
    {
    id: "suwon-hyundai-hillstate",
    name: "ìˆ˜ì› í˜„ëŒ€ê±´ì„¤ íìŠ¤í…Œì´íŠ¸",
    league: "domestic",
    sport: "volleyball"
  },
    {
    id: "incheon-heungkuk-life-pink-spiders",
    name: "ì¸ì²œ í¥êµ­ìƒëª… í•‘í¬ìŠ¤íŒŒì´ë”ìŠ¤",
    league: "domestic",
    sport: "volleyball"
  },
    {
    id: "suwon-hyundai-hillstate",
    name: "ìˆ˜ì› í˜„ëŒ€ê±´ì„¤ íìŠ¤í…Œì´íŠ¸",
    league: "domestic",
    sport: "volleyball"
  },
    {
    id: "daejeon-jung-kwan-jang-red-sparks",
    name: "ëŒ€ì „ ì •ê´€ì¥ ë ˆë“œìŠ¤íŒŒí¬ìŠ¤",
    league: "domestic",
    sport: "volleyball"
  },
     {
    id: "gs-caltex-seoul-kixx",
    name: "GSì¹¼í…ìŠ¤ ì„œìš¸",
    league: "domestic",
    sport: "volleyball"
  },
    {
    id: "hwaseong-ibk-altos",
    name: "í™”ì„± IBKê¸°ì—…ì€í–‰ ì•Œí† ìŠ¤",
    league: "domestic",
    sport: "volleyball"
  },
    {
    id: "gimcheon-korea-expressway-hi-pass",
    name: "ê¹€ì²œ í•œêµ­ë„ë¡œê³µì‚¬ í•˜ì´íŒ¨ìŠ¤",
    league: "domestic",
    sport: "volleyball"
  },
     {
    id: "gwangju-pepper-savings-bank-ai-peppers",
    name: "ê´‘ì£¼ í˜í¼ì €ì¶•ì€í–‰ AI í˜í¼ìŠ¤",
    league: "domestic",
    sport: "volleyball"
  },
    {
    id: "hanwha-life-esports",
    name: "Hanwha Life Esports",
    league: "domestic",
    sport: "lol"
  },
    {
    id: "Geng",
    name: "Gen.G",
    league: "domestic",
    sport: "lol"
  }, 
    {
    id: "DK",
    name: "Dplus KIA",
    league: "domestic",
    sport: "lol"
  },
    {
    id: "nongshim-redforce",
    name: "Nongshim RedForce",
    league: "domestic",
    sport: "lol"
  },
    {
    id: "kt-rolster",
    name: "kt Rolster",
    league: "domestic",
    sport: "lol"
  },
    {
    id: "T1",
    name: "T1",
    league: "domestic",
    sport: "lol"
  },
    {
    id: "DRX",
    name: "DRX",
    league: "domestic",
    sport: "lol"
  },
    {
    id: "oksavingsbank-brion",
    name: "OKSavingsBank BRION",
    league: "domestic",
    sport: "lol"
  },
    {
    id: "DN-FREECS",
    name: "DN FREECS",
    league: "domestic",
    sport: "lol"
  },
    {
    id: "BNK-FEARX",
    name: "BNK FEARX",
    league: "domestic",
    sport: "lol"
  },
];

/* ===== ìƒíƒœ ===== */
const state = {
  tab: "domestic",   // domestic | overseas
  search: "",
  // ì˜¤ë¥¸ìª½ íŒ¨ë„ì˜ ì‹¤ì œ ì„ íƒ ìƒíƒœ
  homeTeamId: null,
  awayTeamId: null,
  homeScore: 0,
  awayScore: 0,
  textColor: "#000000",
  bgColor: "#FFFFFF",
  // ì™¼ìª½ íŒ¨ë„ ê°•ì¡° ìƒíƒœ(ìš°ë¦¬/ìƒëŒ€ ë²„íŠ¼ ëˆŒëŸ¬ì„œ í‘œì‹œë§Œ)
  leftPanelSelected: {
    home: null,
    away: null
  }
};

/* ===== DOM íšë“ ===== */
const $ = (sel, root = document) => root.querySelector(sel);
const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

const el = {
  // í—¤ë”
  resetLeft: $("#reset-left-only"),

  // ì™¼ìª½ íŒ¨ë„
  teamSearch: $("#team-search"),
  tabDomestic: $("#tab-domestic"),
  tabOverseas: $("#tab-overseas"),
  sportsGroups: $(".sports-groups"),
  // ê° ì¢…ëª© íŒ€ ë¦¬ìŠ¤íŠ¸ UL (ì—¬ê¸°ì„œëŠ” ì•¼êµ¬ë§Œ ë™ì  ë Œë”ë§ ì˜ˆì‹œ)
  // ë°ì´í„°ì— ë”°ë¼ ì „ ì¢…ëª© ë Œë”ë§ í•˜ë¯€ë¡œ ë™ì ìœ¼ë¡œ ì¡ìŒ
  // ì˜¤ë¥¸ìª½ íŒ¨ë„ - ë¯¸ë¦¬ë³´ê¸°
  stage: $('[data-role="preview-stage"]'),
  homeLogoBox: $('[data-role="home-logo-box"]'),
  awayLogoBox: $('[data-role="away-logo-box"]'),
  homeName: $('[data-role="home-name"]'),
  awayName: $('[data-role="away-name"]'),
  homeScore: $('[data-role="home-score"]'),
  awayScore: $('[data-role="away-score"]'),
  // ì˜¤ë¥¸ìª½ íŒ¨ë„ - ì»¨íŠ¸ë¡¤
  homeTeamInput: $('[data-role="home-team-input"]'),
  awayTeamInput: $('[data-role="away-team-input"]'),
  homeScoreInput: $('[data-role="home-score-input"]'),
  awayScoreInput: $('[data-role="away-score-input"]'),
  textColor: $('[data-role="text-color"]'),
  textColorHex: $('[data-role="text-color-hex"]'),
  bgColor: $('[data-role="bg-color"]'),
  bgColorHex: $('[data-role="bg-color-hex"]'),
  // ë‹¤ìš´ë¡œë“œ
  downloadBtn: $("#download-btn"),
};

/* ===== ì´ˆê¸° ë Œë”ë§ ===== */
init();

async function init() {
  buildLeftLists();
  bindEvents();
  renderRightPanel();
  afterDomReadyAttachAutocomplete();
}

/* =========================
   ì™¼ìª½ íŒ¨ë„ êµ¬ì¶•/ë Œë”
   ========================= */
function buildLeftLists() {
  const sections = $$(".sport-group", el.sportsGroups);

  sections.forEach(section => {
    const sport = section.getAttribute("data-sport");
    const ul = $(".team-list", section);
    const toggleBtn = $(".sport-toggle", section);

    // í•„í„°ë§
    const teams = TEAM_DB.filter(t =>
      t.sport === sport &&
      t.league === state.tab &&
      matchSearch(t)
    );

    // ì¹´ìš´íŠ¸ ê°±ì‹ 
    const countSpan = $("[data-count]", section);
    if (countSpan) countSpan.textContent = teams.length;

    // ë¦¬ìŠ¤íŠ¸ ë‹¤ì‹œ ê·¸ë¦¼
    ul.innerHTML = "";
    teams.forEach(team => {
      const li = document.createElement("li");
      li.className = "team-item";
      li.dataset.teamId = team.id;

      const itemBtn = document.createElement("button");
      itemBtn.className = "team-select";
      itemBtn.dataset.role = "select-team";
      itemBtn.dataset.team = team.id;

      // â¬‡ï¸ ë¡œê³ : í”„ë¦¬ë¡œë“œ ì„±ê³µ ì‹œ team.svg, ì‹¤íŒ¨ ì‹œ íŒŒì¼ ê²½ë¡œë¡œ í´ë°±
      const logoSpan = document.createElement("span");
      logoSpan.className = "team-logo";
      logoSpan.innerHTML = `<img src="${logoPath(team)}" alt="${team.name} ë¡œê³ " width="40" height="40" loading="lazy">`;

      const nameSpan = document.createElement("span");
      nameSpan.className = "team-name";
      nameSpan.textContent = team.name;

      itemBtn.append(logoSpan, nameSpan);

      const actions = document.createElement("div");
      actions.className = "team-actions";

      const btnHome = document.createElement("button");
      btnHome.className = "btn-mini";
      btnHome.dataset.role = "set-home";
      btnHome.dataset.team = team.id;
      btnHome.textContent = "ìš°ë¦¬ íŒ€";
      if (state.leftPanelSelected.home === team.id) btnHome.classList.add("is-selected");

      const btnAway = document.createElement("button");
      btnAway.className = "btn-mini";
      btnAway.dataset.role = "set-away";
      btnAway.dataset.team = team.id;
      btnAway.textContent = "ìƒëŒ€ íŒ€";
      if (state.leftPanelSelected.away === team.id) btnAway.classList.add("is-selected");

      actions.append(btnHome, btnAway);
      li.append(itemBtn, actions);
      ul.appendChild(li);
    });

    // ê²€ìƒ‰ ì‹œ ìë™ í¼ì¹¨ / í‰ì†Œì—” ê¸°ì¡´ ìƒíƒœ ìœ ì§€
    if (state.search && state.search.trim() !== "") {
      const shouldOpen = teams.length > 0;
      toggleBtn?.setAttribute("aria-expanded", String(shouldOpen));
      ul.hidden = !shouldOpen;
    } else {
      const expanded = toggleBtn?.getAttribute("aria-expanded") === "true";
      ul.hidden = !expanded;
    }
  });
}

// ê³µë°±/í•˜ì´í”ˆ/ì /ìŠ¬ë˜ì‹œ ë“±ì„ ì œê±°í•˜ê³  ì†Œë¬¸ìë¡œ ë³€í™˜
function norm(str) {
  return String(str)
    .toLowerCase()
    .replace(/[\s\-._/Â·ãƒ»]/g, ""); // í•„ìš” ì‹œ ë‹¤ë¥¸ êµ¬ë¶„ìë„ ì¶”ê°€
}

function matchSearch(team) {
  if (!state.search) return true;
  const q = norm(state.search);
  return norm(team.name).includes(q) || norm(team.id).includes(q);
}

function logoPath(team) {
return `${LOGO_BASE}/${LEAGUE_DIR[team.league]}/${SPORT_DIR[team.sport]}/${team.id}.svg`;
}

/* =========================
   ì˜¤ë¥¸ìª½ íŒ¨ë„ ë Œë”
   ========================= */
function renderRightPanel() {
  // ë°°ê²½/ê¸€ì ìƒ‰
  el.stage.style.backgroundColor = state.bgColor;
  $$(".team-label, .score, .vs", el.stage).forEach(n => n.style.color = state.textColor);

  // íŒ€ëª…
  el.homeName.textContent = state.homeTeamId ? getTeam(state.homeTeamId).name : "ìš°ë¦¬ íŒ€";
  el.awayName.textContent = state.awayTeamId ? getTeam(state.awayTeamId).name : "ìƒëŒ€ íŒ€";

  // ì ìˆ˜
  el.homeScore.textContent = state.homeScore;
  el.awayScore.textContent = state.awayScore;

  // ë¡œê³ (SVG ì‚½ì…)
  const homeTeam = state.homeTeamId ? getTeam(state.homeTeamId) : null;
  el.homeLogoBox.innerHTML = homeTeam
  ? `<img src="${logoPath(homeTeam)}" alt="${homeTeam?.name} ë¡œê³ " width="180" height="180" loading="lazy">`
  : placeholderBox();

const awayTeam = state.awayTeamId ? getTeam(state.awayTeamId) : null;
el.awayLogoBox.innerHTML = awayTeam
  ? `<img src="${logoPath(awayTeam)}" alt="${awayTeam?.name} ë¡œê³ " width="180" height="180" loading="lazy">`
  : placeholderBox();

  // ì…ë ¥ì°½ ë™ê¸°í™”(ì½ê¸°ì „ìš© í…ìŠ¤íŠ¸)
  el.homeTeamInput.value = state.homeTeamId ? getTeam(state.homeTeamId).name : "";
  el.awayTeamInput.value = state.awayTeamId ? getTeam(state.awayTeamId).name : "";

  // ìƒ‰ìƒ ì…ë ¥ ë™ê¸°í™”
  el.textColor.value = state.textColor;
  el.textColorHex.value = state.textColor.toUpperCase();
  el.bgColor.value = state.bgColor;
  el.bgColorHex.value = state.bgColor.toUpperCase();
}

function placeholderBox() {
  // ë¯¸ì„ íƒ ì‹œ ì ì„  ë°•ìŠ¤ ëŠë‚Œ
  return "";
}

function getTeam(id) {
  return TEAM_DB.find(t => t.id === id) || null;
}

/* =========================
   ì´ë²¤íŠ¸ ë°”ì¸ë”©
   ========================= */
function bindEvents() {
  // íƒ­ ì „í™˜
  el.tabDomestic.addEventListener("click", () => { setTab("domestic"); });
  el.tabOverseas.addEventListener("click", () => { setTab("overseas"); });

  // ê²€ìƒ‰
  el.teamSearch.addEventListener("input", e => {
    state.search = e.target.value;
    buildLeftLists();
  });

  // ì•„ì½”ë””ì–¸ í† ê¸€
  el.sportsGroups.addEventListener("click", e => {
    const toggle = e.target.closest(".sport-toggle");
    if (toggle) {
      const section = toggle.closest(".sport-group");
      const ul = $(".team-list", section);
      const expanded = toggle.getAttribute("aria-expanded") === "true";
      toggle.setAttribute("aria-expanded", String(!expanded));
      ul.hidden = expanded;
      return;
    }

    // íŒ€ ì§€ì •(ìš°ë¦¬/ìƒëŒ€)
    const setHome = e.target.closest('[data-role="set-home"]');
    const setAway = e.target.closest('[data-role="set-away"]');

    if (setHome) {
      const id = setHome.dataset.team;
      state.homeTeamId = id;
      state.leftPanelSelected.home = id; // ì™¼ìª½ íŒ¨ë„ í‘œì‹œë§Œ
      renderRightPanel();
      buildLeftLists(); // ë²„íŠ¼ ê°•ì¡° ë°˜ì˜
    }
    if (setAway) {
      const id = setAway.dataset.team;
      state.awayTeamId = id;
      state.leftPanelSelected.away = id; // ì™¼ìª½ íŒ¨ë„ í‘œì‹œë§Œ
      renderRightPanel();
      buildLeftLists();
    }
  });

  // ì ìˆ˜ ì…ë ¥
  el.homeScoreInput.addEventListener("input", e => {
    state.homeScore = clampNonNegativeInt(e.target.value);
    el.homeScoreInput.value = state.homeScore;
    renderRightPanel();
  });
  el.awayScoreInput.addEventListener("input", e => {
    state.awayScore = clampNonNegativeInt(e.target.value);
    el.awayScoreInput.value = state.awayScore;
    renderRightPanel();
  });

  // ìƒ‰ìƒ -> HEX í…ìŠ¤íŠ¸ ë™ê¸°í™” (ì–‘ë°©í–¥)
  el.textColor.addEventListener("input", e => {
    state.textColor = normalizeHex(e.target.value);
    renderRightPanel();
  });
  el.textColorHex.addEventListener("input", e => {
    const hex = normalizeHex(e.target.value);
    if (hex) state.textColor = hex;
    renderRightPanel();
  });
  el.bgColor.addEventListener("input", e => {
    state.bgColor = normalizeHex(e.target.value);
    renderRightPanel();
  });
  el.bgColorHex.addEventListener("input", e => {
    const hex = normalizeHex(e.target.value);
    if (hex) state.bgColor = hex;
    renderRightPanel();
  });

  // ì „ì²´ ì´ˆê¸°í™”
el.resetLeft.addEventListener("click", () => {
  // 1) ìƒíƒœ ê¸°ë³¸ê°’
  state.tab = "domestic";
  state.search = "";
  state.homeTeamId = null;
  state.awayTeamId = null;
  state.homeScore = 0;
  state.awayScore = 0;
  state.textColor = "#000000";
  state.bgColor = "#FFFFFF";
  state.leftPanelSelected.home = null;
  state.leftPanelSelected.away = null;

  // 2) ì…ë ¥ê°’ ì´ˆê¸°í™”
  if (el.teamSearch) el.teamSearch.value = "";
  el.homeScoreInput.value = 0;
  el.awayScoreInput.value = 0;
  el.textColor.value = "#000000";
  el.textColorHex.value = "#000000";
  el.bgColor.value = "#FFFFFF";
  el.bgColorHex.value = "#FFFFFF";

  // 3) íƒ­ ìƒíƒœ ì´ˆê¸°í™” (êµ­ë‚´ ì„ íƒ)
  el.tabDomestic.setAttribute("aria-selected", "true");
  el.tabOverseas.setAttribute("aria-selected", "false");

  // 4) ì•„ì½”ë””ì–¸ ì´ˆê¸°í™” (ëª¨ë‘ ì ‘ê¸°)
$$(".sport-group", el.sportsGroups).forEach(section => {
  const toggle = $(".sport-toggle", section);
  const ul = $(".team-list", section);
  if (toggle) toggle.setAttribute("aria-expanded", "false");
  if (ul) ul.hidden = true;
});

  // 5) ë‹¤ì‹œ ë Œë”
  buildLeftLists();
  renderRightPanel();
});


  // ë‹¤ìš´ë¡œë“œ
  el.downloadBtn.addEventListener("click", () => downloadComposite());
}

function setTab(tab) {
  state.tab = tab;
  // ARIA ì—…ë°ì´íŠ¸
  el.tabDomestic.setAttribute("aria-selected", String(tab === "domestic"));
  el.tabOverseas.setAttribute("aria-selected", String(tab === "overseas"));
  buildLeftLists();
}

/* =========================
   ìœ í‹¸
   ========================= */
function clampNonNegativeInt(v) {
  const n = parseInt(v, 10);
  if (Number.isNaN(n) || n < 0) return 0;
  return n;
}

function normalizeHex(v) {
  if (!v) return "#000000";
  let x = v.trim().toUpperCase();
  if (!x.startsWith("#")) x = "#" + x;
  // #RGBë¥¼ #RRGGBBë¡œ í™•ì¥
  if (/^#([0-9A-F]{3})$/.test(x)) {
    const r = x[1], g = x[2], b = x[3];
    x = `#${r}${r}${g}${g}${b}${b}`;
  }
  if (/^#([0-9A-F]{6})$/.test(x)) return x;
  return null;
}

  // ê³µë°± ë¬´ì‹œ ë¹„êµìš© (ì´ë¯¸ ìˆìœ¼ë©´ ì‚¬ìš©)
function norm(str){ return String(str).toLowerCase().replace(/[\s\-._/Â·ãƒ»]/g, ""); }

// ì…ë ¥ì¹¸ì— ìë™ì™„ì„± ë¶™ì´ê¸°
function attachAutocomplete(inputEl, side){ // side: 'home' | 'away'
  if(!inputEl) return;

  // ë¶€ëª¨ë¥¼ ê¸°ì¤€ ìœ„ì¹˜ë¡œ
  const parent = inputEl.parentElement;
  if (getComputedStyle(parent).position === "static") parent.style.position = "relative";

  // ë©”ë‰´ ìƒì„±
  const menu = document.createElement("div");
  menu.className = "autocomplete-menu";
  menu.hidden = true;
  parent.appendChild(menu);

  // ë©”ë‰´ ë Œë”
  function renderMenu(items){
    menu.innerHTML = "";
    if(!items.length){ menu.hidden = true; return; }
    items.slice(0, 10).forEach(team => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "autocomplete-item";
      btn.innerHTML = `
        <span class="team-logo"><img src="${logoPath(team)}" alt=""></span>
        <span class="team-name">${team.name}</span>
      `;
      btn.addEventListener("click", () => {
        // ìƒíƒœ ì—…ë°ì´íŠ¸ (ì¢Œ/ìš° íŒ¨ë„ ë™ê¸°í™”)
        if(side === "home"){
          state.homeTeamId = team.id;
          state.leftPanelSelected.home = team.id;
          // ì…ë ¥ì¹¸ ê°’ ê³ ì •
          inputEl.value = team.name;
        }else{
          state.awayTeamId = team.id;
          state.leftPanelSelected.away = team.id;
          inputEl.value = team.name;
        }
        // UI ê°±ì‹ 
        renderRightPanel();
        buildLeftLists();
        closeMenu();
      });
      menu.appendChild(btn);
    });
    menu.hidden = false;
  }

  function closeMenu(){ menu.hidden = true; }

  function update(){
    const q = norm(inputEl.value);
    if(q === ""){ closeMenu(); return; }
    // íƒ­(êµ­ë‚´/í•´ì™¸)ì™€ ê²€ìƒ‰ì–´ ê¸°ì¤€ìœ¼ë¡œ í›„ë³´ ë§Œë“¤ê¸°
    const items = TEAM_DB.filter(t =>
      t.league === state.tab && norm(t.name).includes(q)
    );
    renderMenu(items);
  }

  // ì´ë²¤íŠ¸
  inputEl.addEventListener("input", update);
  inputEl.addEventListener("focus", update);
  inputEl.addEventListener("keydown", (e) => {
    if(e.key === "Escape"){ closeMenu(); inputEl.blur(); }
  });
  // blur ì‹œ ë°”ë¡œ ë‹«ìœ¼ë©´ í´ë¦­ ëª»í•˜ë‹ˆ ì‚´ì§ ì§€ì—°
  inputEl.addEventListener("blur", () => setTimeout(closeMenu, 120));
}

// ì´ˆê¸°í™” ì‹œ í•œ ë²ˆë§Œ ì¥ì°©
function afterDomReadyAttachAutocomplete(){
  attachAutocomplete(el.homeTeamInput, "home");
  attachAutocomplete(el.awayTeamInput, "away");
}


/* =========================
   ë‹¤ìš´ë¡œë“œ (SVG í•©ì„± â†’ PNG/SVG)
   - SVG ë‚´ë¶€ì— íŒ€ ë¡œê³  SVGë¥¼ <g>ë¡œ ì‚½ì…
   - í…ìŠ¤íŠ¸/ìŠ¤ì½”ì–´/ìƒ‰ìƒ ë°˜ì˜
   ========================= */
// PNGë§Œ ì €ì¥, ë¡œê³  SVGëŠ” ensureTeamSvgë¡œ í™•ë³´
async function downloadComposite() {
  // ì•„íŠ¸ë³´ë“œ
  const W = 1160, H = 400;
  const padding = 60;
  const logoBox = 280;

  // ìŠ¤íƒ€ì¼
  const tColor = state.textColor;
  const bg = state.bgColor;

  // íŒ€ ë°ì´í„°
  const home = state.homeTeamId ? getTeam(state.homeTeamId) : null;
  const away = state.awayTeamId ? getTeam(state.awayTeamId) : null;

  // ë¡œê³  SVG ë¬¸ìì—´ í™•ë³´ (ì—†ìœ¼ë©´ fetchí•´ì„œ team.svg ì±„ì›€)
  const homeSvg = await ensureTeamSvg(home);
  const awaySvg = await ensureTeamSvg(away);

  const homeLogo = homeSvg ? wrapSVG(homeSvg, logoBox, logoBox, `home-${home?.id}-`) : dashedRect(logoBox, logoBox, "#DDDDDD");
  const awayLogo = awaySvg ? wrapSVG(awaySvg, logoBox, logoBox, `away-${away?.id}-`) : dashedRect(logoBox, logoBox, "#DDDDDD");

  // ë°°ì¹˜(Bì•ˆ)
  const leftLogoX  = W/2 - 420;
  const rightLogoX = W/2 + 140;
  const logoY      = H/2 - logoBox/2 - 40;
  const scoreY     = H/2 + logoBox/2 + 80;

  const svg = `
<svg xmlns="http://www.w3.org/2000/svg" width="${W}" height="${H}" viewBox="0 0 ${W} ${H}">
  <rect width="100%" height="100%" fill="${bg}"/>
  <g transform="translate(${leftLogoX}, ${logoY})">${homeLogo}</g>
  <g transform="translate(${rightLogoX}, ${logoY})">${awayLogo}</g>

  <text x="${W/2}" y="${H/2 - 40}" fill="${tColor}" text-anchor="middle"
        font-family="Inter, Pretendard, Arial, sans-serif" font-weight="700" font-size="80">vs</text>

  <text x="${W/2 - 280}" y="${scoreY}" fill="${tColor}" text-anchor="middle"
        font-family="Inter, Pretendard, Arial, sans-serif" font-weight="800" font-size="96">${state.homeScore}</text>
  <text x="${W/2 + 280}" y="${scoreY}" fill="${tColor}" text-anchor="middle"
        font-family="Inter, Pretendard, Arial, sans-serif" font-weight="800" font-size="96">${state.awayScore}</text>
</svg>
  `.trim();

  // âœ… PNGë§Œ ì €ì¥
  const pngBlob = await svgToPng(svg, W, H);
  const url = URL.createObjectURL(pngBlob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "cover.png";
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

// XML/Doctype ì œê±°
function stripXmlDoctype(svg){
  return svg.replace(/<\?xml[\s\S]*?\?>/ig, "").replace(/<!DOCTYPE[\s\S]*?>/ig, "");
}

// id ì¶©ëŒ ì˜ˆë°©: id="xxx" â†’ id="${prefix}xxx"
// url(#xxx), href="#xxx", xlink:href="#xxx" ë„ í•¨ê»˜ ì¹˜í™˜
function scopeSvgIds(svg, prefix){
  const ids = new Set();
  svg = svg.replace(/\bid="([^"]+)"/g, (_, id) => {
    ids.add(id);
    return `id="${prefix}${id}"`;
  });
  ids.forEach((id) => {
    svg = svg
      .replace(new RegExp(`url\\(#${id}\\)`, "g"), `url(#${prefix}${id})`)
      .replace(new RegExp(`(href=['"])#${id}(['"])`, "g"), `$1#${prefix}${id}$2`)
      .replace(new RegExp(`(xlink:href=['"])#${id}(['"])`, "g"), `$1#${prefix}${id}$2`);
  });
  return svg;
}

// âœ… ì¶©ëŒ ì—†ì´, ë°•ìŠ¤ ì•ˆì— ë§ì¶° ë…ë¦½ <svg>ë¡œ ì‚½ì…
function wrapSVG(svgString, maxW, maxH, prefix = ""){
  let raw = stripXmlDoctype(svgString);
  raw = scopeSvgIds(raw, prefix);   // â† í•µì‹¬

  const vb = getViewBox(raw) || [0,0,512,512];
  const [, , vw, vh] = vb;
  const scale = Math.min(maxW / vw, maxH / vh);
  const tx = (maxW - vw * scale) / 2;
  const ty = (maxH - vh * scale) / 2;

  // ë‚´ë¶€ë§Œ êº¼ë‚´ì„œ ìƒˆ <svg viewBox="...">ë¡œ ê°ì‹¸ë©´ ìŠ¤íƒ€ì¼/IDê°€ í•´ë‹¹ ë¡œê³  ë‚´ë¶€ë¡œë§Œ í•œì •ë¨
  const inner = stripOuterSVG(raw);
  return `<g transform="translate(${tx},${ty}) scale(${scale})">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="${vb.join(' ')}">${inner}</svg>
  </g>`;
}


function dashedRect(w, h, color) {
  return `<rect width="${w}" height="${h}" rx="16" ry="16" fill="none" stroke="${color}" stroke-width="4" stroke-dasharray="8 8"/>`;
}

function getViewBox(svgString) {
  const m = svgString.match(/viewBox\s*=\s*["']([\d\.\s\-]+)["']/i);
  if (!m) return null;
  const nums = m[1].trim().split(/\s+/).map(Number);
  if (nums.length === 4 && nums.every(n => !isNaN(n))) return nums;
  return null;
}

function stripOuterSVG(svgString) {
  // <svg ...> ... </svg> -> ë‚´ë¶€ë§Œ
  return svgString
    .replace(/^[\s\S]*?<svg[^>]*>/i, "")
    .replace(/<\/svg>\s*$/i, "");
}

function escapeXML(str) {
  return String(str)
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;")
    .replace(/'/g,"&apos;");
}

function downloadAs(filename, mime, data) {
  const blob = new Blob([data], { type: mime });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

function svgToPng(svgString, width, height) {
  return new Promise((resolve) => {
    const svgBlob = new Blob([svgString], { type: "image/svg+xml;charset=utf-8" });
    const url = URL.createObjectURL(svgBlob);
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement("canvas");
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, width, height);
      canvas.toBlob((blob) => {
        URL.revokeObjectURL(url);
        resolve(blob);
      }, "image/png");
    };
    img.src = url;
  });
}
</script>

</body>
</html>
